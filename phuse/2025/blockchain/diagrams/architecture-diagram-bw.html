<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain Clinical Trial Architecture (B&W)</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Times New Roman', 'Georgia', serif;
            background: white;
            padding: 20px;
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            font-size: 22px;
            color: #000;
            margin-bottom: 20px;
            font-weight: bold;
        }
        .caption {
            text-align: center;
            font-size: 14px;
            color: #000;
            margin-bottom: 10px;
            font-style: italic;
        }
        .mermaid {
            text-align: center;
            background: white;
            margin: 20px 0;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            padding: 10px 20px;
            margin: 0 5px;
            background: #000;
            color: white;
            border: 2px solid #000;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
        }
        button:hover { 
            background: #333;
            border-color: #333;
        }
        @media print {
            .controls { display: none; }
            body { padding: 0; }
            h1 { page-break-after: avoid; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Figure 1: Four-Layer Blockchain Architecture for Clinical Trials</h1>
        
        <div class="controls">
            <button onclick="window.print()">ðŸ“¥ Export PDF</button>
            <button onclick="exportSVG()">ðŸ“Š Export SVG</button>
            <button onclick="window.location.href='architecture-diagram.html'">ðŸŽ¨ Switch to Color</button>
        </div>
        
        <div class="caption">(a) System Architecture</div>
        <div class="mermaid">
graph TB
    subgraph L1["LAYER 1: DATA GENERATION"]
        direction LR
        EC["eConsent<br/>Consent Docs"]
        EDC["EDC<br/>SDTM Data"]
        LIMS["LIMS<br/>Lab Results"]
    end
    
    subgraph L2["LAYER 2: BLOCKCHAIN ANCHORING"]
        direction TB
        
        subgraph NET["Hyperledger Fabric Network"]
            direction LR
            SP["Sponsor Peer<br/>(Org1)<br/>Consent Mgmt"]
            CRO["CRO Peer<br/>(Org2)<br/>Data Anchoring"]
            ORD["Orderer<br/>Consensus"]
        end
        
        SC["Smart Contract<br/>RegisterConsent()<br/>AnchorDataset()<br/>Policy Enforcement"]
        
        BL["Blockchain Ledger<br/>Block 1: Genesis<br/>Block 2: CONSENT_SUBJ001<br/>Block 3: ANCHOR_DM_1.0<br/>Block N: ..."]
    end
    
    subgraph L3["LAYER 3: OFF-CHAIN STORAGE"]
        ST["WORM Storage<br/>consent.json (15KB)<br/>DM.csv (1MB)<br/>AE.csv (40MB)<br/>LB.csv (400MB)<br/>Encrypted, Versioned"]
    end
    
    subgraph L4["LAYER 4: VERIFICATION"]
        REG["Regulator<br/>1. Receive data<br/>2. Query blockchain<br/>3. Compute SHA-256<br/>4. Compare hashes"]
    end
    
    EC --> SP
    EDC --> CRO
    LIMS --> CRO
    
    SP --> SC
    CRO --> SC
    SC --> BL
    
    SP <--> ORD
    CRO <--> ORD
    ORD --> BL
    
    SP --> ST
    CRO --> ST
    
    BL -.->|Query Hash| REG
    ST -.->|Receive Data| REG
    
    classDef layer1 fill:#fff,stroke:#000,stroke-width:3px,color:#000,stroke-dasharray: 5 5
    classDef layer2 fill:#f5f5f5,stroke:#000,stroke-width:3px,color:#000
    classDef layer3 fill:#fff,stroke:#000,stroke-width:3px,color:#000,stroke-dasharray: 3 3
    classDef layer4 fill:#e8e8e8,stroke:#000,stroke-width:3px,color:#000
    classDef peer fill:#fff,stroke:#000,stroke-width:2px,color:#000
    classDef contract fill:#d0d0d0,stroke:#000,stroke-width:2px,color:#000
    classDef storage fill:#fff,stroke:#000,stroke-width:2px,color:#000
    
    class L1 layer1
    class L2 layer2
    class L3 layer3
    class L4 layer4
    class SP,CRO,ORD peer
    class SC,BL contract
    class ST storage
        </div>
        
        <div class="caption">(b) Data Flow Sequence</div>
        <div class="mermaid">
sequenceDiagram
    autonumber
    participant S as Subject
    participant Sp as Sponsor
    participant SC as Contract
    participant BL as Ledger
    participant C as CRO
    participant Reg as Regulator

    Note over S,Reg: Consent â†’ Data â†’ Verify
    
    rect rgb(240, 240, 240)
    Note right of S: Phase 1: Consent
    S->>Sp: Sign consent
    Sp->>SC: RegisterConsent(hash)
    SC->>BL: Store consent
    end
    
    rect rgb(255, 255, 255)
    Note right of C: Phase 2: Anchoring
    C->>C: Process SDTM
    C->>SC: AnchorDataset(hash)
    SC->>BL: Check consent active?
    alt Consent Active
        SC->>BL: Store hash
        BL-->>C: Confirmed
    else Consent Withdrawn
        SC-->>C: REJECTED
    end
    end
    
    rect rgb(240, 240, 240)
    Note right of Reg: Phase 3: Verification
    Reg->>BL: Query hash
    Reg->>Reg: Compute local hash
    alt Hashes Match
        Reg->>Reg: Data Authentic
    else Hashes Mismatch
        Reg->>Reg: Data Tampered
    end
    end
        </div>
        
        <p style="font-size: 12px; margin-top: 20px; line-height: 1.6;">
            <strong>Figure 1.</strong> The four-layer architecture comprises: (1) Data Generation from source systems, 
            (2) Blockchain Anchoring via Hyperledger Fabric with smart contract policy enforcement, 
            (3) Off-Chain WORM storage for full datasets ensuring privacy, and 
            (4) Regulator Verification through independent hash comparison. 
            Solid lines indicate write operations; dashed lines indicate read/query operations.
            Different fill patterns distinguish the architectural layers for grayscale printing.
        </p>
    </div>
    
    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'base',
            themeVariables: {
                primaryColor: '#fff',
                primaryTextColor: '#000',
                primaryBorderColor: '#000',
                lineColor: '#000',
                secondaryColor: '#f0f0f0',
                tertiaryColor: '#fff',
                fontSize: '13px',
                fontFamily: 'Times New Roman, Georgia, serif'
            },
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis',
                padding: 15
            },
            sequence: {
                useMaxWidth: true,
                actorMargin: 80,
                messageMargin: 50,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageAlign: 'center',
                mirrorActors: false
            }
        });
        
        function exportSVG() {
            const svgs = document.querySelectorAll('.mermaid svg');
            if (svgs.length === 0) {
                alert('Please wait for diagrams to render');
                return;
            }
            
            svgs.forEach((svg, index) => {
                const svgData = new XMLSerializer().serializeToString(svg);
                const blob = new Blob([svgData], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `figure-1${String.fromCharCode(97 + index)}.svg`;
                link.click();
                URL.revokeObjectURL(url);
            });
        }
    </script>
</body>
</html>

